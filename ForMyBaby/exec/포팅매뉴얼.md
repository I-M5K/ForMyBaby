
# 포팅 매뉴얼

## :one: Gitlab 소스 클론 이후 빌드 및 배포할 수 있도록 정리한 문서

### (1) 사용한 JVM, 웹서버, WAS 제품 등의 종류와 설정 값, 버전(IDE버전 포함) 기재

* JVM : Oracle Open JDK version 17
* 웹 서버 : nginx~~
* WAS : tomcat 10.1.19
* IDE : Intellij 2023.3.2
* Jenkins
* Nginx
* Docker
* SpringBoot 3.2.3
* Mysql 8.3.0

### (2) 빌드 시 사용되는 환경 변수 등의 내용 상세 기재
- IntelliJ 빌드/실행 환경변수
  - DB_PASSWORD=ssafy;DB_URL=jdbc:mysql://j10c202.p.ssafy.io:3307/formybaby?useSSL\=false&characterEncoding\=UTF-8&serverTimezone\=UTC&allowPublicKeyRetrieval\=true;DB_USER=root;KAKAO_ID=f9d3aa3c4d425c0ad175a6b95e366769;KAKAO_PW=Mx4luiTuOBM8RAuJRU9AZ0UJdGtQrRVh;KAKAO_REDIRECT_URI=https://j10c202.p.ssafy.io/oauth/redirected/kakao;REDIS_HOST=j10c202.p.ssafy.io;REDIS_PASSWORD=imok202!;REDIS_PORT=6379;S3_ACCESS_KEY=AKIA2UC3BWP55UET3D4E;S3_BUCKET=formybaby-bucket;S3_REGION=ap-northeast-2;S3_SECRET_KEY=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

    > DB_PASSWORD, DB_URL, DB_USER : DB 접속 정보

    > KAKAO_ID, KAKAO_PW, KAKAO_REDIRECT_URI : 카카오 소셜 로그인을 위한 인증 정보

    > REDIS_HOST, REDIS_PASSWORD, REDIS_PORT : 레디스 접속정보
    
    > S3_ACCESS_KEY, S3_SECRET_KEY : S3 접속정보

- Application 설정 파일
  - application.yml

    > DB, JPA, Batch, OAuth, Redis, S3 연결에 대한 설정 정보

  - resources/firebase/serviceAccountKey.json

    > Firebase Clouding Messaging 에 사용되는 Admin Key 설정 정보

### (3) 배포 시 특이사항 기재

- ignore 된 파일들은 Jenkins Credentials 를 활용하여 key를 주입받도록 해준다.

  <details>
  <summary>

  **Jenkins Credentials 적용 Flow**

  </summary>

  - Jenkins 접속 후 `Jenkins 관리` - `Credentials` 이동
  - `Credentials` 의 저장된 `scoped` 중에서, `domains` 의 `global` 클릭
  - `Add Credentials` 클릭
  - 현재 숨겨지고 있고, `crendentials` 에 등록하려느 파일은 key 파일이므로, `kind` 는 `secret file` 설정
  - `id` 는 편한 것으로 네이밍하되, 향후 파이프라인 내에서 사용 시 필요한 value
  - `description` 역시 편하게 작성한다.
  - 이후 Jenkins Pipeline 이 설정되어 있는 파일로 이동한다. (JenkinsFile.groovy)
  - 해당 파이프라인 내에서, 적절한 위치에서 `application-key.properties` 가 작성되어야 한다. 현재 `GitLab` 내에 `Back-end` 폴더를 git clone 한 후, 빌드를 진행하므로 빌드 전에 해당 properties 가 존재해야만 정상적인 빌드, 배포가 가능해질 것이다.
  - 따라서 `Git clone stage` 와 `Back Build` 사이에 `properties` 를 추가하는 stage 가 위치하도록 한다.
  - stage 작성 시, 해당 계정이 `properties` 가 위치할 directory에 대해 작성 권한이 없을 수 있다. 따라서 디렉터리에 대해서 작성을 하려면 읽기 권한이 있어야 하고(x), `properties` 를 작성해야 하며(w), 디렉토리 하위 레벨에 모두 적용해야 그 하위에 위치할 `properties`가 적용되므로 하위 전파 옵션을 적용해야하며(-R), 파일이 위치할 디렉토리 하위에 대해서 읽기가 가능해야 전파 옵션 적용이 가능하다 ( r ).
  - 따라서 해당 디렉토리에 `-R a=rwx` 옵션을 적용해준다.

  ```plaintext
  stage('Git clone') {...}
  stage('Add Env') {
          steps {
              dir('./backend') {
                  withCredentials([file(credentialsId: 'key', variable: 'key')]) {
                      sh 'chmod -R a=rwx src/main/resources'
                      sh 'cp ${key} src/main/resources/application-key.properties'
                  }
              }
          }
      } 
  stage('build backend') {...}
  ```

  </details>



### (4) DB 접속 정보 등 프로젝트(ERD)에 활용되는 주요 계정 및 프로퍼티가 정의된 파일 목록

- DB 접속 정보 : application.yml

```plaintext
    spring:
      datasource:
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: ${DB_URL}
        username: ${DB_USER}
        password: ${DB_PASSWORD}
```

## :two: 프로젝트에서 사용하는 외부 서비스 정보를 정리한 문서

### 소셜 로그인

- 카카오 로그인 API

> https://developers.kakao.com/docs/latest/ko/kakaologin/common


### 알람 서비스

- Firebase Cloud Messaging

> https://firebase.google.com/docs/reference/fcm/rest/v1/projects.messages?hl=ko#apnsfcmoption

### 파일 업로드 데이터베이스

- Amazon S3

> https://s3.console.aws.amazon.com/s3/home

### 캐시 서버

- Redis

> https://redis.io/docs/

## :three: DB 덤프 파일 최신본

- `exec` 폴더 내 `formybaby.sql` 파일 참조

## :four: 시연 시나리오

- 로그인 및 튜토리얼 화면
|제목|내용|설명|
|:---|---:|:---:|
|왼쪽정렬|오른쪽정렬|중앙정렬|
|왼쪽정렬|오른쪽정렬|중앙정렬|
|왼쪽정렬|오른쪽정렬|중앙정렬|
- 가족 공유코드 화면

- (가족 공유코드 입력시)

- (가족 공유코드 없을 시)

- 메인화면

- 아이 지킴이 화면

- 푸시 알림

- 접종/검진 타임라인

- 성장 스탬프
